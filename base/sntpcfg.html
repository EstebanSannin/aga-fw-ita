<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
	(c) 2005 U.S. Robotics Corporation
-->
<html>
<head>
	<title>Device &raquo; Time</title>

	<link href="usr_main.css" rel="stylesheet" type="text/css">
	<link href="usr_menus.css" rel="stylesheet" type="text/css"><script src="usr_menus.js" type="text/javascript"></script><script src="usr_menus_build.js" type="text/javascript"></script>
	<script src="usr_common.js" type="text/javascript"></script

	<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
	<script type="text/javascript">
<!-- hide

setPageTitle("<%ejGetWlJS(wlInterface)%>");

var state = '<%ejGetSntp(sntpRefresh)%>';
if ( state == '1' ) {
   var code = 'location = "sntpcfg.sntp?sntpRefresh=0"';
   eval(code);
}

var ntpServers = new Array(
									"clock.fmt.he.net",
									"clock.nyc.he.net",
									"clock.sjc.he.net",
									"clock.via.net",
									"ntp1.tummy.com",
									"time.cachenetworks.com",
									"time.nist.gov"
								);

var timeZones = new Array(
									"(UTC-12:00) International Date Line West",
									"(UTC-11:00) Midway Island, Samoa",
									"(UTC-10:00) Hawaii",
									"(UTC-09:00) Alaska",
									"(UTC-08:00) Pacific Time, Tijuana",
									"(UTC-07:00) Arizona, Mazatlan",
									"(UTC-07:00) Chihuahua, La Paz",
									"(UTC-07:00) Mountain Time",
									"(UTC-06:00) Central America",
									"(UTC-06:00) Central Time",
									"(UTC-06:00) Guadalajara, Mexico City, Monterrey",
									"(UTC-06:00) Saskatchewan",
									"(UTC-05:00) Bogota, Lima, Quito",
									"(UTC-05:00) Eastern Time",
									"(UTC-05:00) Indiana",
									"(UTC-04:00) Atlantic Time",
									"(UTC-04:00) Caracas, La Paz",
									"(UTC-04:00) Santiago",
									"(UTC-03:30) Newfoundland",
									"(UTC-03:00) Brasilia",
									"(UTC-03:00) Buenos Aires, Georgetown",
									"(UTC-03:00) Greenland",
									"(UTC-02:00) Mid-Atlantic",
									"(UTC-01:00) Azores",
									"(UTC-01:00) Cape Verde Is.",
									"(UTC) Casablanca, Monrovia",
									"(UTC) Universal Coordinated Time: Dublin, Edinburgh, Lisbon, London",
									"(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna",
									"(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague",
									"(UTC+01:00) Brussels, Copenhagen, Madrid, Paris",
									"(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb",
									"(UTC+01:00) West Central Africa",
									"(UTC+02:00) Athens, Istanbul, Minsk",
									"(UTC+02:00) Bucharest",
									"(UTC+02:00) Cairo",
									"(UTC+02:00) Harare, Pretoria",
									"(UTC+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius",
									"(UTC+02:00) Jerusalem",
									"(UTC+03:00) Baghdad",
									"(UTC+03:00) Kuwait, Riyadh",
									"(UTC+03:00) Moscow, St. Petersburg, Volgograd",
									"(UTC+03:00) Nairobi",
									"(UTC+03:30) Tehran",
									"(UTC+04:00) Abu Dhabi, Muscat",
									"(UTC+04:00) Baku, Tbilisi, Yerevan",
									"(UTC+04:30) Kabul",
									"(UTC+05:00) Ekaterinburg",
									"(UTC+05:00) Islamabad, Karachi, Tashkent",
									"(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi",
									"(UTC+05:45) Kathmandu",
									"(UTC+06:00) Almaty, Novosibirsk",
									"(UTC+06:00) Astana, Dhaka",
									"(UTC+06:00) Sri Jayawardenepura",
									"(UTC+06:30) Rangoon",
									"(UTC+07:00) Bangkok, Hanoi, Jakarta",
									"(UTC+07:00) Krasnoyarsk",
									"(UTC+08:00) Beijing, Chongquing, Hong Kong, Urumqi",
									"(UTC+08:00) Irkutsk, Ulaan Bataar",
									"(UTC+08:00) Kuala Lumpur, Singapore",
									"(UTC+08:00) Perth",
									"(UTC+08:00) Taipei",
									"(UTC+09:00) Osaka, Sapporo, Tokyo",
									"(UTC+09:00) Seoul",
									"(UTC+09:00) Yakutsk",
									"(UTC+09:30) Adelaide",
									"(UTC+09:30) Darwin",
									"(UTC+10:00) Brisbane",
									"(UTC+10:00) Canberra, Melbourne, Sydney",
									"(UTC+10:00) Guam, Port Moresby",
									"(UTC+10:00) Hobart",
									"(UTC+10:00) Vladivostok",
									"(UTC+11:00) Magadan",
									"(UTC+11:00) Solomon Is., New Caledonia",
									"(UTC+12:00) Auckland, Wellington",
									"(UTC+12:00) Fiji, Kamchatka, Marshall Is."
								);

function getTimeZoneIndex(timeZoneName) {
  var i = 0, ret = 4;  // default to Pacific time

  for ( var i = 0; i < timeZones.length; i++ ) {
    if ( timeZones[i].search(timeZoneName) != -1 )
      break;
  }

  if ( i < timeZones.length )
    ret = i;

  return ret;
}

function getTimeZoneName(idx) {
  var str = timeZones[idx];
  var ret = '';

  if ( idx != 25 && idx != 26 )
    ret = str.substr(12);
  else
    ret = str.substr(6);

  return ret;
}

function getTimeZoneOffset(idx) {
  var str = timeZones[idx];
  var ret = '';

  if ( idx != 25 && idx != 26 )
    ret = str.substr(4, 6);

  return ret;
}

function writeTimeZoneList() {
  for( var i = 0; i < timeZones.length; i++ )
    document.writeln("<option value=" + getTimeZoneOffset(i) + ">" + timeZones[i] + "</option>");
}

function ntpChange(optionlist,textbox) {
  if( optionlist[optionlist.selectedIndex].value == "Other" )
    textbox.disabled = false;
  else {
    textbox.value = "";
    textbox.disabled = true;
  }
}

function btnApply() {
  var loc = 'sntpcfg.sntp?ntp_enabled=';

  with( document.forms[0] ) {
    if( ntpEnabled.checked ) {
      loc += '1&ntpServer1=';
      if( ntpServer1.selectedIndex == ntpServers.length ) {
        if( ntpServerOther1.value.length == 0 ) { // == Other
          alert("The first time server is \"Other,\" but the IP address field is blank.");
          return;
        } else {
          loc += ntpServerOther1.value;
        }
      } else {
        loc += ntpServer1[ntpServer1.selectedIndex].value;
      }

      loc += '&ntpServer2=';
      if( ntpServer2.selectedIndex == ntpServers.length+1 ) {
        if( ntpServerOther2.value.length == 0 ) { // == Other
          alert("The second time server is \"Other,\" but the IP address field is blank.");
          return;
        } else {
          loc += ntpServerOther2.value;
        }
      } else {
        if( ntpServer2.selectedIndex > 0 )
          loc += ntpServer2[ntpServer2.selectedIndex].value;
      }

      loc += '&timezone_offset=' + cboTimeZone[cboTimeZone.selectedIndex].value;
      loc += '&timezone=' + getTimeZoneName(cboTimeZone.selectedIndex);

      loc += '&use_dst=0';
    } else {
      loc += '0';
    }
  }
  var code = 'location = "' + loc + '";';
  eval(code);
}

function frmLoad() {
  var i = 0;
  var ntp1 = "<%ejGetSntp(ntpServer1)%>";
  var ntp2 = "<%ejGetSntp(ntpServer2)%>";
  var ntp_enabled = "<%ejGetSntp(ntp_enabled)%>";
  var tz_name = "<%ejGetSntp(timezone)%>";

  with (document.forms[0]) {
    if( ntp_enabled == "1" ) {
      ntpEnabled.checked = true;
    } else {
      ntpEnabled.checked = false;
    }

    if( ntp1.length ) {
      for( i = 0; i < ntpServers.length; i++ ) {
        if( ntp1 == ntpServers[i] ) {
          ntpServer1.selectedIndex = i;
          break;
        }
      }
      if( i == ntpServers.length ) {
        ntpServer1.selectedIndex = i; // Set to 'Other'
        ntpServerOther1.value = ntp1;
      }
    }
    ntpChange(ntpServer1,ntpServerOther1);

    if( ntp2.length ) {
      for( i = 0; i < ntpServers.length; i++ ) {
        if( ntp2 == ntpServers[i] ) {
          ntpServer2.selectedIndex = i+1;
          break;
        }
      }
      if( i == ntpServers.length ) {
        ntpServer2.selectedIndex = i+1; // Set to 'Other'
        ntpServerOther2.value = ntp2;
      }
    }
    ntpChange(ntpServer2,ntpServerOther2);

    cboTimeZone.selectedIndex = getTimeZoneIndex(tz_name);

    ntpEnblChange();
  }
}

function hideNtpConfig(hide) {
  var status = 'visible';

  if(hide)
    status = 'hidden';

  if( document.getElementById )
    document.getElementById('ntpConfig').style.visibility = status;
  else
    if(!document.layers)
      document.all.ntpConfig.style.visibility = status;
}

function ntpEnblChange() {
  if( document.forms[0].ntpEnabled.checked )
    hideNtpConfig(0);
  else
    hideNtpConfig(1);
}

function writeNtpList(needed) {
	if(!needed)
		document.writeln("<option value=\"None\">Disable</option>");
	for( var i = 0; i < ntpServers.length; i++ )
		document.writeln("<option value=" + ntpServers[i] + ">" + ntpServers[i] + "</option>");
	document.writeln("<option value=\"Other\">(specify IP address manually)</option>");
}

	// done hiding -->
	</script>
</head>
<body onload="initMenu(); frmLoad();">

<script type="text/javascript">
	writeHeader("Device", "<%ejGetJS(curUserName)%>", "<%ejGetOther(sysInfo, adslStd)%>", "<%ejGetOther(sysInfo, noBrPrtcl)%>", <%ejGetOther(sysInfo, pppIpExtension)%>, <%ejGetOther(sysInfo, enblFirewall)%>, <%ejGetOther(sysInfo, enblNat)%>, "<%ejGetWlJS(wlInterface)%>", <%ejGetJS(enblQos)%>);
</script>

<h3>Time</h3>

<p>This page allows you to configure the router&rsquo;s time servers.</p>

<form>
	<p><input type="checkbox" name="ntpEnabled" id="ntpEnabled" onClick="ntpEnblChange()"> <label for="ntpEnabled">Automatically synchronize with Internet time servers</label></p>

	<div id="ntpConfig">
		<table border="0" cellpadding="2" cellspacing="0">
			<tr>
				<td><label for="">Time server 1:</label></td>
				<td>
					<select name="ntpServer1" id="ntpServer1" onChange="ntpChange(this.form.ntpServer1,this.form.ntpServerOther1)">
<script type="text/javascript">
	writeNtpList(true);
</script>
					</select>
				</td>
				<td><input type="text" name="ntpServerOther1" id="ntpServerOther1"></td>
			</tr>
			<tr>
				<td><label for="">Time server 2:</label></td>
				<td>
					<select name="ntpServer2" id="ntpServer2" onChange="ntpChange(this.form.ntpServer2,this.form.ntpServerOther2)">
<script type="text/javascript">
	writeNtpList(false);
</script>
					</select>
				</td>
				<td><input type="text" name="ntpServerOther2" id="ntpServerOther2"></td>
			</tr>

			<tr>
				<td><label for="">Time zone offset:</label></td>
				<td colspan="2">
					<select name="cboTimeZone" id="cboTimeZone">
<script type="text/javascript">
	writeTimeZoneList();
</script>
					</select>
				</td>
			</tr>
		</table>
	</div>

	<p><input type="button" value="Save" onClick="btnApply()"></p>
</form>

<script type="text/javascript">
	writeFooter();
</script>

</body>
</html>
